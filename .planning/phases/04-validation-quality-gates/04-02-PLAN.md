---
phase: 04-validation-quality-gates
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [".github/workflows/pages.yml"]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "CI/CD pipeline runs typecheck before build and fails on TypeScript errors"
    - "CI/CD pipeline runs lint before build and fails on ESLint errors"
    - "CI/CD pipeline runs prettier-lint as non-blocking check (warnings only)"
    - "Developer receives immediate feedback when pushing code that violates quality gates"
  artifacts:
    - path: ".github/workflows/pages.yml"
      provides: "Validation steps before build in GitHub Actions workflow"
      min_lines: 85
      contains: "bun run typecheck"
  key_links:
    - from: ".github/workflows/pages.yml"
      to: "package.json scripts"
      via: "bun run commands"
      pattern: "bun run (typecheck|lint|prettier-lint)"
---

<objective>
Add validation gates to GitHub Actions CI/CD pipeline to enforce code quality standards automatically.

Purpose: Close verification gap where local validation works perfectly but CI/CD does not enforce quality gates, allowing code that breaks validation to be deployed. Phase 4 goal is "code quality standards are enforced going forward" which requires CI automation, not just local capability.

Output: Updated `.github/workflows/pages.yml` with validation steps (typecheck, lint, prettier-lint) that run before build and fail-fast on errors.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-validation-quality-gates/04-01-VERIFICATION.md
@.planning/phases/04-validation-quality-gates/04-01-SUMMARY.md
@.github/workflows/pages.yml
@package.json
</context>

<tasks>

<task type="auto">
  <name>Add validation steps to GitHub Actions workflow</name>
  <files>.github/workflows/pages.yml</files>
  <action>
Add three validation steps to the `build` job in `.github/workflows/pages.yml`, placed AFTER "Install dependencies" step and BEFORE "Build website" step:

1. **TypeScript validation step (blocking):**

   ```yaml
   - name: Run TypeScript validation
     run: bun run typecheck
   ```

   This step will fail the workflow if TypeScript compilation errors exist (exit code ≠ 0).

2. **ESLint validation step (blocking):**

   ```yaml
   - name: Run ESLint validation
     run: bun run lint
   ```

   This step will fail the workflow if ESLint finds errors (exit code ≠ 0). Warnings are acceptable.

3. **Prettier validation step (non-blocking, warnings only):**
   ```yaml
   - name: Run Prettier check (warnings only)
     run: bun run prettier-lint || true
   ```
   This step runs Prettier format checking but does NOT fail the workflow (|| true ensures exit code 0). This makes formatting violations visible without blocking deployment.

**Critical notes:**

- Use `bun run` not `npm run` (CI uses bun package manager, see existing "Build website" step)
- Place steps AFTER line 41 ("Install dependencies") and BEFORE line 43 ("Build website")
- Preserve all existing workflow structure (triggers, permissions, deploy job, caching, security hardening)
- Maintain exact indentation (2 spaces per level in YAML)
- Do NOT modify deploy job or any other workflow configuration
- Gap reason: Phase 4 established local validation capability but did not integrate with CI/CD, defeating the enforcement goal

**Why this order matters:**

- Typecheck first: Catches compilation errors immediately (fastest feedback)
- Lint second: Code quality issues (slightly slower than typecheck)
- Prettier last: Formatting is cosmetic and non-blocking (slowest, but doesn't fail build)
  </action>
  <verify>
  Check that the workflow file contains validation steps:

```bash
grep -A 2 "Run TypeScript validation" .github/workflows/pages.yml
grep -A 2 "Run ESLint validation" .github/workflows/pages.yml
grep -A 2 "Run Prettier check" .github/workflows/pages.yml
```

Verify step order (validation before build):

```bash
# Extract step names from build job and verify order
sed -n '/jobs:/,/deploy:/p' .github/workflows/pages.yml | grep "name:" | head -6
```

Expected output should show validation steps between "Install dependencies" and "Build website".

Validate YAML syntax:

```bash
# Use Python to validate YAML structure
python3 -c "import yaml; yaml.safe_load(open('.github/workflows/pages.yml'))" && echo "YAML valid"
```

  </verify>
  <done>
The `.github/workflows/pages.yml` file contains three new validation steps:
- TypeScript validation step exists and uses `bun run typecheck` (blocking)
- ESLint validation step exists and uses `bun run lint` (blocking)
- Prettier check step exists and uses `bun run prettier-lint || true` (non-blocking)
- Steps are positioned after "Install dependencies" and before "Build website"
- YAML syntax is valid
- All existing workflow configuration is preserved unchanged
  </done>
</task>

</tasks>

<verification>
After completing this plan:

1. **Local verification:**

   ```bash
   # Verify workflow file structure
   cat .github/workflows/pages.yml | grep -E "(typecheck|lint|prettier-lint)"

   # Validate YAML syntax
   python3 -c "import yaml; yaml.safe_load(open('.github/workflows/pages.yml'))"
   ```

2. **CI verification (post-merge):**
   - Push changes to a test branch
   - Open pull request to trigger workflow
   - Verify GitHub Actions log shows validation steps running
   - Confirm typecheck and lint steps can fail the build (test by introducing a TypeScript error)
   - Confirm prettier-lint shows warnings but does not fail build

3. **Gap closure verification:**
   - Truth "CI/CD pipeline enforces validation gates automatically" can now be re-verified
   - Workflow runs typecheck, lint, and prettier-lint before build
   - Build fails if typecheck or lint fail (fail-fast behavior)
   - Prettier violations are visible but non-blocking
     </verification>

<success_criteria>

1. `.github/workflows/pages.yml` contains validation steps that run before build
2. TypeScript validation (`bun run typecheck`) runs and can fail the workflow
3. ESLint validation (`bun run lint`) runs and can fail the workflow
4. Prettier check (`bun run prettier-lint || true`) runs but never fails the workflow
5. YAML syntax is valid and workflow structure is preserved
6. Gap from 04-01-VERIFICATION.md is closed: CI/CD now enforces validation gates
7. Phase 4 goal fully achieved: "Code quality standards are enforced going forward" via automation
   </success_criteria>

<output>
After completion, create `.planning/phases/04-validation-quality-gates/04-02-SUMMARY.md`

Include:

- Changes made to workflow file
- Validation strategy (blocking vs non-blocking)
- CI/CD enforcement confirmation
- Gap closure status (Truth #5 from VERIFICATION.md now passes)
- Testing recommendations for PR workflow
  </output>
