---
phase: 01-configuration-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
autonomous: true

must_haves:
  truths:
    - "User can run npm install without --legacy-peer-deps flag"
    - "npm install completes without peer dependency warnings"
    - "npm run build completes without peer dependency warnings"
    - "All dependencies in package.json have corresponding usage in codebase"
    - "TypeScript configuration is valid and extends official Docusaurus config"
  artifacts:
    - path: "package.json"
      provides: "npm overrides for React 19"
      contains: '"overrides"'
    - path: "package.json"
      provides: "Clean dependency list with no unused packages"
      min_lines: 40
    - path: "tsconfig.json"
      provides: "TypeScript configuration extending @docusaurus/tsconfig"
      contains: "@docusaurus/tsconfig"
  key_links:
    - from: "package.json"
      to: "npm install"
      via: "overrides field forces React 19 throughout dependency tree"
      pattern: "overrides.*react"
    - from: "package.json"
      to: "codebase imports"
      via: "every dependency has import statement"
      pattern: 'from [''"](@|[a-z])'
---

<objective>
Establish clean, reproducible npm dependency installation using npm overrides for React 19 peer dependency resolution.

Purpose: Eliminates --legacy-peer-deps workaround and provides stable foundation for type system and component cleanup. No peer dependency warnings, no unused dependencies, validated TypeScript configuration.

Output: Updated package.json with npm overrides, cleaned dependency list, validated configuration files.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/01-configuration-foundation/01-RESEARCH.md
@AGENTS.md
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Add npm overrides for React 19 peer dependencies</name>
  <files>package.json</files>
  <action>
Add npm overrides field to package.json to force React 19 throughout the dependency tree, eliminating the need for --legacy-peer-deps flag.

**Implementation:**

1. Read current package.json
2. Add "overrides" field at the root level (same level as dependencies/devDependencies):
   ```json
   "overrides": {
     "react": "^19.0.0",
     "react-dom": "^19.0.0"
   }
   ```
3. Place overrides field AFTER devDependencies, BEFORE browserslist for readability
4. Write updated package.json

**Why npm overrides (not --legacy-peer-deps):**

- Research (01-RESEARCH.md) confirms this is the official npm solution since npm 8.3.0
- Docusaurus 3.7.0 officially supports React 19
- Overrides is surgical (only forces specific packages), --legacy-peer-deps is blanket disabling
- Makes the fix explicit in package.json (not a hidden command flag)

**Critical:** Do NOT use $react or $react-dom reference syntax - use direct version strings matching the dependencies field. The $ syntax is for referencing other override values, not for referencing dependencies.
</action>
<verify>

```bash
# Verify overrides field exists
grep -A 3 '"overrides"' package.json

# Test clean install without --legacy-peer-deps
rm -rf node_modules package-lock.json
npm install 2>&1 | tee /tmp/npm-install.log

# Check for peer dependency warnings (should be none or minimal)
grep -i "peer" /tmp/npm-install.log || echo "No peer dependency warnings ✓"

# Verify build works
npm run build 2>&1 | grep -i "peer" || echo "Build has no peer dependency warnings ✓"
```

  </verify>
  <done>
- package.json contains "overrides" field with react and react-dom set to ^19.0.0
- npm install completes successfully without --legacy-peer-deps flag
- No peer dependency warnings during installation or build
- package-lock.json updated with override resolutions
  </done>
</task>

<task type="auto">
  <name>Audit and remove unused dependencies</name>
  <files>package.json</files>
  <action>
Identify and remove unused dependencies from package.json to reduce attack surface and maintain clarity.

**Audit process:**

1. Check for extraneous packages (already in node_modules but not in package.json):

   ```bash
   npm ls --depth=0 2>&1 | grep "extraneous"
   ```

   - Current known: @emnapi/core, @emnapi/runtime, @emnapi/wasi-threads, @tybys/wasm-util
   - These are transitive dependencies, do NOT add to package.json
   - Run `npm prune` to remove them from node_modules

2. Search for import usage of each dependency:

   ```bash
   # For each package in dependencies + devDependencies
   rg "from ['\"]package-name" --type ts --type tsx --type js --type jsx
   rg "require\(['\"]package-name" --type ts --type tsx --type js --type jsx
   ```

3. Check package.json scripts for usage (e.g., prettier in scripts)

4. Known usage patterns:
   - Dependencies with @docusaurus prefix: Core framework (keep all)
   - xml2js: Used by fetch-feeds.js script (keep)
   - node-fetch: Used by fetch scripts (keep)
   - React packages: Core framework (keep)
   - clsx: Likely used in components (verify with grep)
   - prism-react-renderer: Docusaurus code highlighting (keep)
   - caniuse-lite: Build-time browser support data (keep)
   - @giscus/react: Comments component (verify with grep)
   - @1password/docusaurus-plugin-stored-data: Feed storage plugin (verify in docusaurus.config.ts)
   - @easyops-cn/docusaurus-search-local: Search plugin (verify in docusaurus.config.ts)
   - @mdx-js/react: MDX support (core dependency, keep)
   - @docusaurus/theme-mermaid: Diagram rendering (verify in docusaurus.config.ts)

5. **DO NOT REMOVE** any package that appears in:
   - docusaurus.config.ts plugins or themes array
   - package.json scripts
   - Has import/require statements in src/ or scripts/
   - Is a peer dependency of kept packages

6. If all 21 dependencies (16 deps + 5 devDeps) are used, document this in task output

**Expected outcome:** Either removal of truly unused packages OR confirmation all are used.
</action>
<verify>

```bash
# Verify no extraneous packages remain
npm ls --depth=0 2>&1 | grep "extraneous" && echo "ERROR: Extraneous packages found" || echo "No extraneous packages ✓"

# Count dependencies
echo "Dependencies: $(cat package.json | grep -A 100 '"dependencies"' | grep -B 100 '"devDependencies"' | grep '":' | wc -l)"
echo "DevDependencies: $(cat package.json | grep -A 100 '"devDependencies"' | grep -B 100 '"browserslist"' | grep '":' | wc -l)"

# Run build to ensure nothing broke
npm run build
```

  </verify>
  <done>
- npm prune executed, no extraneous packages in node_modules
- All packages in package.json have documented usage (imports, scripts, or plugins)
- npm run build completes successfully with cleaned dependencies
- Either unused packages removed OR all 21 packages confirmed as used with evidence
  </done>
</task>

<task type="auto">
  <name>Validate TypeScript and Docusaurus configuration</name>
  <files>None (validation only)</files>
  <action>
Validate that TypeScript configuration correctly extends @docusaurus/tsconfig and that Docusaurus configuration follows best practices.

**TypeScript validation:**

1. Verify tsconfig.json extends "@docusaurus/tsconfig" (already confirmed in context)
2. Check that compilerOptions.baseUrl is set to "." (already confirmed)
3. Verify exclude array contains ".docusaurus" and "build" (already confirmed)
4. Run `npm run typecheck` to baseline current TypeScript errors:
   - Expected: 14 errors from components (CONFIG-01 note: "some errors may be tolerated by build")
   - These are TYPE and COMP issues for Phases 2-3
   - Document error count and sample errors for comparison

**Docusaurus configuration validation:**

1. Read docusaurus.config.ts
2. Verify it uses TypeScript with proper type imports:
   ```typescript
   import type { Config } from "@docusaurus/types";
   import type * as Preset from "@docusaurus/preset-classic";
   ```
3. Check configuration structure:
   - Config export with proper typing
   - Preset configuration with satisfies Preset.Options
   - ThemeConfig with satisfies Preset.ThemeConfig
4. Verify critical plugins are configured (research mentions these):
   - @docusaurus/preset-classic
   - @docusaurus/theme-mermaid (if used)
   - Search plugin
   - Any custom plugins

**Research alignment:**

- Reference 01-RESEARCH.md patterns for validation
- Ensure configuration matches Docusaurus 3.8.1+ best practices
- Document any deviations or warnings for future phases

**Critical note from AGENTS.md:**

- Development server uses detached mode workflow
- Build-time data fetching scripts are critical infrastructure
- Deployment configuration is immutable
  </action>
  <verify>

```bash
# TypeScript validation
npm run typecheck 2>&1 | tee /tmp/typecheck-baseline.log
echo "TypeScript error count: $(grep -c "error TS" /tmp/typecheck-baseline.log || echo "0")"

# Docusaurus config syntax check
npm run build 2>&1 | grep -i "config" | head -20

# Verify dev server can start (using detached mode from AGENTS.md)
pkill -f docusaurus 2>/dev/null || true
sleep 2
npm start 2>&1 | tee /tmp/docusaurus-test.log &
DEV_PID=$!
sleep 15
curl -I http://localhost:3000/ 2>&1 | head -5
kill $DEV_PID 2>/dev/null || true
pkill -f docusaurus 2>/dev/null || true
```

  </verify>
  <done>
- tsconfig.json verified to extend @docusaurus/tsconfig correctly
- npm run typecheck baseline established (14 expected errors documented)
- docusaurus.config.ts follows TypeScript best practices with proper type imports
- Development server starts successfully with clean configuration
- All validation commands pass (npm run typecheck, npm run build, npm run start)
- Configuration foundation is stable for Phase 2 type system work
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify the configuration foundation:

1. **Clean installation test:**

   ```bash
   rm -rf node_modules package-lock.json
   npm install
   # Should complete without --legacy-peer-deps flag
   # Should have zero or minimal peer dependency warnings
   ```

2. **Build test:**

   ```bash
   npm run build
   # Should complete successfully
   # Should fetch data (feeds, playlists, profiles) automatically
   # Should have no peer dependency warnings
   ```

3. **Validation suite:**

   ```bash
   npm run typecheck  # Baseline errors documented
   npm run prettier-lint  # Expected warnings on existing files
   ```

4. **Dependencies audit:**
   ```bash
   npm ls --depth=0 | grep extraneous
   # Should return nothing (no extraneous packages)
   ```

All success criteria from ROADMAP.md Phase 1 should be met.
</verification>

<success_criteria>

1. User can run `npm install` without `--legacy-peer-deps` flag and installation completes successfully
2. User can run `npm run build` and build completes without peer dependency warnings
3. All dependencies in package.json have corresponding import statements or usage in codebase (zero unused dependencies)
4. TypeScript configuration extends `@docusaurus/tsconfig` and compiles without configuration errors
5. Development server starts reliably using documented workflow from AGENTS.md

**Measurable outcomes:**

- package.json contains "overrides" field: ✓/✗
- npm install exit code 0 without flags: ✓/✗
- grep "peer" in build output: 0 matches
- npm ls extraneous: 0 packages
- npm run typecheck: Baseline established (14 errors expected, not configuration errors)
  </success_criteria>

<output>
After completion, create `.planning/phases/01-configuration-foundation/01-01-SUMMARY.md` following the summary template.

Include:

- Exact npm overrides configuration added
- List of dependencies audited with usage evidence
- TypeScript error baseline count
- Any deviations from research recommendations with rationale
  </output>
