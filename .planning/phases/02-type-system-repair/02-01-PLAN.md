---
phase: 02-type-system-repair
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/theme.d.ts
  - src/types/data.d.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript compiler recognizes correct shape of feed data from useStoredFeed hook"
    - "Components can access rss.channel.item and feed.entry properties without type errors"
    - "Auto-generated JSON data has proper TypeScript interfaces"
    - "Type errors decrease from 14 to 1 after type system fixes"
    - "JSX namespace is properly imported in BlogPostItem wrapper"
  artifacts:
    - path: "src/types/theme.d.ts"
      provides: "Corrected FeedData interface matching actual plugin structure"
      min_lines: 50
      exports: ["FeedData", "FeedItem", "ParsedFeed"]
    - path: "src/types/data.d.ts"
      provides: "TypeScript interfaces for auto-generated JSON files"
      min_lines: 40
      exports:
        ["PlaylistMetadata", "GitHubUser", "GitHubRepoStats", "GnomeExtension"]
    - path: "src/theme/BlogPostItem/index.tsx"
      provides: "JSX namespace import"
      contains: "import React from 'react'"
      min_lines: 13
  key_links:
    - from: "src/types/theme.d.ts"
      to: "src/components/FeedItems.tsx"
      via: "import useStoredFeed from '@theme/useStoredFeed'"
      pattern: "useStoredFeed.*FeedData"
    - from: "src/types/theme.d.ts"
      to: "src/components/PackageSummary.tsx"
      via: "import useStoredFeed from '@theme/useStoredFeed'"
      pattern: "useStoredFeed.*feedData"
    - from: "src/types/data.d.ts"
      to: "src/components/MusicPlaylist.tsx"
      via: "import metadata from '@site/static/data/playlist-metadata.json'"
      pattern: "PlaylistMetadata"
---

<objective>
Correct TypeScript type definitions for Docusaurus hooks and auto-generated data structures to eliminate root cause of 13 out of 14 component TypeScript errors.

Purpose: Components depend on type definitions. The current theme.d.ts declares FeedData as `{ items: FeedItem[] }` but the actual structure from the useStoredFeed hook is a ParsedFeed with nested RSS/Atom variations (`rss.channel.item` or `feed.entry`). This mismatch causes 13 TypeScript errors in FeedItems.tsx and PackageSummary.tsx. Fixing types first prevents "whack-a-mole" pattern where fixing components creates new errors.

Output: Corrected type definitions that match actual runtime data structures, reducing TypeScript errors from 14 to 1 (only BlogPostItem JSX namespace remains).
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-configuration-foundation/01-01-SUMMARY.md
@.planning/research/SUMMARY.md
@.planning/codebase/CONCERNS.md
@src/types/theme.d.ts
@src/components/FeedItems.tsx
@src/components/PackageSummary.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix FeedData type definition to match actual useStoredFeed structure</name>
  <files>src/types/theme.d.ts</files>
  <action>
The current FeedData interface in theme.d.ts is incorrect. It declares `{ items: FeedItem[] }` but the actual runtime structure from the @1password/docusaurus-plugin-stored-data plugin returns parsed RSS/Atom feed XML with these variations:

- RSS feeds: `{ rss: { channel: { item: FeedItem[] } } }`
- Atom feeds: `{ feed: { entry: FeedItem[] } }`
- Alternative: `{ channel: { item: FeedItem[] } }`

**Replace the entire `@theme/useStoredFeed` module declaration with:**

```typescript
declare module "@theme/useStoredFeed" {
  interface FeedItem {
    title: string;
    link:
      | string
      | { href?: string }
      | Array<{
          href?: string;
          rel?: string;
          $?: { href?: string; type?: string };
        }>;
    description?: string;
    pubDate?: string;
    updated?: string;
    guid?: string;
    id?: string;
    author?: string | { name?: string };
    content?: { value?: string } | string;
  }

  interface ParsedFeed {
    // RSS feed structure
    rss?: {
      channel?: {
        item?: FeedItem | FeedItem[];
      };
    };
    // Alternative RSS structure
    channel?: {
      item?: FeedItem | FeedItem[];
    };
    // Atom feed structure
    feed?: {
      entry?: FeedItem | FeedItem[];
    };
  }

  function useStoredFeed(key: string): ParsedFeed | null;
  export default useStoredFeed;
}
```

**Why this structure:**

- ParsedFeed represents the actual XML-to-JSON structure from xml2js parser
- All properties are optional to handle different feed formats
- item/entry can be single object or array (XML parser behavior)
- FeedItem has flexible link structure to handle RSS/Atom link variations
- This matches what FeedItems.tsx already expects (lines 130-142 check all three structures)

**DO NOT:**

- Keep the old `{ items: FeedItem[] }` structure (doesn't match reality)
- Make properties required (feeds vary in structure)
- Simplify the link type (RSS/Atom have different link formats)
  </action>
  <verify>
  npm run typecheck 2>&1 | grep -E "(FeedItems|PackageSummary)" | head -20

Expected: 13 errors in FeedItems.tsx and PackageSummary.tsx should be resolved (rss/channel/feed property errors gone). Only BlogPostItem JSX namespace error should remain.
</verify>
<done>

- src/types/theme.d.ts contains ParsedFeed interface with rss.channel.item, channel.item, and feed.entry paths
- useStoredFeed hook typed as returning ParsedFeed | null
- npm run typecheck shows 0 errors in FeedItems.tsx and PackageSummary.tsx (down from 13)
- Type definitions match actual runtime behavior of @1password/docusaurus-plugin-stored-data
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create TypeScript interfaces for auto-generated JSON data files</name>
  <files>src/types/data.d.ts</files>
  <action>
Create a new file src/types/data.d.ts to define TypeScript interfaces for the 7 auto-generated JSON files in static/data/. This prevents `any` types in components that import this data.

**Create src/types/data.d.ts with these interfaces:**

```typescript
/**
 * Type definitions for auto-generated JSON data files.
 * These files are generated at build time by scripts in scripts/ directory.
 * DO NOT manually edit the JSON files - they are regenerated on every build.
 */

/**
 * YouTube playlist metadata from scripts/fetch-playlist-metadata.js
 * Used by: src/components/MusicPlaylist.tsx
 */
export interface PlaylistMetadata {
  playlistId: string;
  channelName: string;
  playlistTitle: string;
  description: string;
  thumbnail: string;
  videoCount: number;
}

/**
 * GitHub user profile data from scripts/fetch-github-profiles.js
 * Used by: src/components/GitHubProfileCard.tsx, src/pages/donations/contributors.tsx
 */
export interface GitHubUser {
  login: string;
  name: string | null;
  avatar_url: string;
  html_url: string;
  bio: string | null;
  company: string | null;
  location: string | null;
  blog: string | null;
  twitter_username: string | null;
  bluesky_handle?: string;
  mastodon_url?: string;
}

/**
 * GitHub repository stats from scripts/fetch-github-repos.js
 * Used by: src/components/ProjectCard.tsx, src/pages/donations/projects.tsx
 */
export interface GitHubRepoStats {
  repo: string; // Format: "owner/repo"
  stars: number;
  forks: number;
  description: string | null;
  homepage: string | null;
  language: string | null;
}

/**
 * GNOME extension metadata from scripts/fetch-gnome-extensions.js
 * Used by: src/components/GnomeExtensions.tsx
 */
export interface GnomeExtension {
  pk: number;
  name: string;
  description: string;
  link: string;
  icon: string;
  screenshot?: string;
  creator: string;
  creator_url: string;
  shell_version_map: Record<string, { version: number; pk: number }>;
}

/**
 * Project board data from scripts/fetch-board-data.js
 * Used by: src/components/BoardChangelog.tsx
 */
export interface BoardItem {
  id: string;
  title: string;
  url: string;
  createdAt: string;
  updatedAt: string;
  state: string;
  labels: string[];
}

/**
 * File contributors from scripts/fetch-contributors.js
 * Used by: src/components/PageContributors.tsx
 */
export interface FileContributor {
  login: string;
  avatar_url: string;
  html_url: string;
  contributions: number;
}

/**
 * Board changelog items from scripts/fetch-board-data.js
 * Used by: src/components/BoardChangelog.tsx
 */
export interface BoardChangelogItem {
  date: string;
  title: string;
  url: string;
  type: "issue" | "pr";
  state: "open" | "closed" | "merged";
}
```

**After creating the file, components can import like:**

```typescript
import type { PlaylistMetadata } from "@site/src/types/data";
import metadata from "@site/static/data/playlist-metadata.json";

const data = metadata as PlaylistMetadata[];
```

**DO NOT:**

- Make fields required when GitHub API returns nullable values
- Add interfaces for deprecated/unused data files
- Import these types from theme.d.ts (keep data types separate)
  </action>
  <verify>

# Verify file was created with expected exports

grep -E "export interface (PlaylistMetadata|GitHubUser|GitHubRepoStats)" src/types/data.d.ts

# Verify TypeScript recognizes the types

npm run typecheck 2>&1 | grep -c "data.d.ts"

Expected: File exists with 7 interface exports, no TypeScript errors in data.d.ts itself
</verify>
<done>

- src/types/data.d.ts exists with 7 exported interfaces
- Each interface has JSDoc comments explaining source and usage
- Interfaces match actual JSON structure from build scripts
- Components can import and use these types instead of `any`
  </done>
  </task>

<task type="auto">
  <name>Task 3: Fix BlogPostItem JSX namespace error</name>
  <files>src/theme/BlogPostItem/index.tsx</files>
  <action>
The swizzled BlogPostItem wrapper has a TypeScript error: `Cannot find namespace 'JSX'` on line 5. This is because React 19 changed JSX type definitions.

**The fix is already correct in the file** (it imports React on line 1), but TypeScript may need the explicit JSX namespace import for React 19.

**Verify the file contains:**

```typescript
import React from "react";
```

If the error persists after Task 1's type fixes, add explicit JSX import:

```typescript
import React, { JSX } from "react";
```

However, based on research, this error may auto-resolve once the feed type errors are fixed (TypeScript stops before checking this file when earlier errors block).

**Test first after Task 1 completes.** If error remains:

1. Check if @docusaurus/types is imported in Props type
2. Verify React import is present
3. Add `import type { JSX } from 'react'` if still needed

**DO NOT:**

- Unwrap this component (it's intentionally swizzled to disable Giscus comments)
- Change the component logic
- Remove the React import
  </action>
  <verify>
  npm run typecheck 2>&1 | grep "BlogPostItem"

Expected: Either error is gone (auto-resolved), or clear path to fix if it remains. Total TypeScript errors should be 1 or 0.
</verify>
<done>

- BlogPostItem/index.tsx has no TypeScript errors
- Component still functions correctly (imports React, wraps original)
- Total TypeScript errors reduced from 14 to 0
  </done>
  </task>

</tasks>

<verification>
After all tasks complete, run full validation suite:

```bash
# TypeScript validation - expect 0 errors (down from 14)
npm run typecheck

# Build validation - should succeed
npm run build

# Development server test
npm start 2>&1 | tee /tmp/docusaurus-server.log &
sleep 40
curl -I http://localhost:3000/changelogs/
pkill -f "npm start"

# Verify type exports are usable
node -e "const types = require('./src/types/data.d.ts'); console.log('Types loaded')"
```

Expected outcomes:

- TypeScript compilation: 0 errors (was 14)
- Build completes successfully
- Changelogs page loads (uses FeedItems with corrected types)
- No runtime errors in browser console
  </verification>

<success_criteria>

1. npm run typecheck shows 0 TypeScript errors (down from 14 baseline)
2. FeedItems.tsx and PackageSummary.tsx have no type errors accessing rss/channel/feed properties
3. src/types/theme.d.ts declares ParsedFeed interface matching actual plugin structure
4. src/types/data.d.ts exists with 7 exported interfaces for auto-generated JSON files
5. BlogPostItem/index.tsx has no JSX namespace error
6. npm run build completes successfully without type errors
7. Development server starts and changelogs page renders correctly
   </success_criteria>

<output>
After completion, create `.planning/phases/02-type-system-repair/02-01-SUMMARY.md` documenting:
- Type interfaces created and their rationale
- TypeScript error count before/after (14 â†’ 0)
- Verification that types match runtime data structures
- Any deviations from plan (if JSX error required additional fix)
</output>
